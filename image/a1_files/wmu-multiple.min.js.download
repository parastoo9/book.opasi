jQuery(document).ready(function(e){function a(e,a){var t=null,i="";return null!==(t="image"==a?e.attr("id").match(/wmu\-image\-(\d+)/):"video"==a?e.attr("id").match(/wmu\-video\-(\d+)/):e.attr("id").match(/wmu\-file\-(\d+)/))&&(i=t[1]),i}function t(){1==wpdiscuzAjaxObj.wpdiscuz_options.wmuIsLightbox&&e(".wmu-attached-image-link").colorbox({maxHeight:"95%",rel:"wmu-attached-image-link"})}function i(a,t){var i=a.substring(a.lastIndexOf(".")+1);return e.inArray(i.toLowerCase(),t)}if(e(".wmu_reset").val(""),t(),e(document).delegate(".wmu-multiple","click",function(){var a=e(this).children(".wmu-type").val(),t=e(this).parents(".wpdiscuz-textarea-foot"),i=e(".wmu-"+a+"-tab",t);e(".wmu-tabs:not('.wmu-"+a+"-tab')",t).removeClass("wmu-show"),i.toggleClass("wmu-show"),e(".wmu-multiple.wmu-active").removeClass("wmu-active"),e(this).toggleClass("wmu-active"),i.is(":visible")||e(this).removeClass("wmu-active")}),e(document).delegate(".wmu-image","change",function(){var t=e(this),s=a(t,"image"),m=t.parents(".wc_comm_form"),u=e(".wmu-preview-image-"+s,m),o=e("img",u),w=t[0].files?t[0].files:[],c=w[0].name;if(w.length&&i(c,wpdiscuzAjaxObj.wpdiscuz_options.imageAccept)>-1)if(t.parents(".wmu-add-"+s,".wmu-tabs").removeClass("wmu-show"),u.addClass("wmu-show"),u.attr("title",c),window.FileReader){var n=new FileReader;n.readAsDataURL(w[0]),n.onloadend=function(){e(o).attr("src",this.result)}}else e(o).replaceWith('<div class="wmu-filreader-not-exist">'+w[0].name+"</div>")}),e(document).delegate(".wmu-video","change",function(){var t=e(this),s=a(t,"video"),m=t.parents(".wc_comm_form"),u=e(".wmu-preview-video-"+s,m),o=e(".wmu-preview-video-"+s+" .wmu-preview-remove .wmu-file-name",m),w=e("img",u),c=t[0].files?t[0].files:[],n=c[0].name;c.length&&i(n,wpdiscuzAjaxObj.wpdiscuz_options.videoAccept)>-1&&(e(w).attr("src",wpdiscuzAjaxObj.wpdiscuz_options.iconVideoAudio),t.parents(".wmu-add-"+s,".wmu-tabs").removeClass("wmu-show"),u.addClass("wmu-show"),u.attr("title",n),n.length>30&&(n="..."+n.slice(-30)),o.html(n))}),e(document).delegate(".wmu-file","change",function(){var t=e(this),s=a(t,"file"),m=t.parents(".wc_comm_form"),u=e(".wmu-preview-file-"+s,m),o=e(".wmu-preview-file-"+s+" .wmu-preview-remove .wmu-file-name",m),w=e("img",u),c=wpdiscuzAjaxObj.wpdiscuz_options.iconFile,n=t[0].files?t[0].files:[],r=n[0].name;n.length&&i(r,wpdiscuzAjaxObj.wpdiscuz_options.fileAccept)>-1&&(t.parents(".wmu-add-"+s,".wmu-tabs").removeClass("wmu-show"),u.addClass("wmu-show"),u.attr("title",n[0].name),w.attr("src",c),r.length>30&&(r="..."+r.slice(-30)),o.html(r))}),e(document).delegate(".wmu-attachment-delete","click",function(a){if(confirm(wpdiscuzAjaxObj.wpdiscuz_options.confirmDelete)){e(".wpdiscuz-loading-bar").show();var t=new FormData,i=e(this),s=function(e){var a=e.attr("id").match(/wmu\-attach\-remove\-(\d+)/),t=0;null!==a&&(t=a[1]);return t}(i),m=i.parents(".wc-comment-right").attr("id"),u=m.substring(m.lastIndexOf("-")+1),o="";o=i.hasClass("wmu-delete-image")?"image":i.hasClass("wmu-delete-video")?"video":"file",s>0?(t.append("action","removeAttachment"),t.append("commentId",u),t.append("attachmentId",s),t.append("metaKey",o),e.ajax({type:"POST",url:wpdiscuzAjaxObj.url,data:t,contentType:!1,processData:!1}).done(function(a){try{var t=e.parseJSON(a);null!=t&&""!=t&&t.id>0&&e(".wmu-attachment-"+t.id).remove()}catch(e){console.log(e)}e(".wpdiscuz-loading-bar").hide()})):console.log("Cannot get attachment id")}else console.log("canceled")}),e(document).delegate(".wmu-preview","click",function(){var a=e(this),t=e(a).parents(".wmu-tabs"),i="",s="";e(a).hasClass("wmu-preview-image")?(i="image",s=wpdiscuzAjaxObj.wpdiscuz_options.imageAccept):e(a).hasClass("wmu-preview-video")?(i="video",s=wpdiscuzAjaxObj.wpdiscuz_options.videoAccept):(i="file",s=wpdiscuzAjaxObj.wpdiscuz_options.fileAccept);var m=function(e,a){var t=null,i="";t="image"==a?e.attr("class").match(/wmu\-preview\-image\-(\d+)/):"video"==a?e.attr("class").match(/wmu\-preview\-video\-(\d+)/):e.attr("class").match(/wmu\-preview\-file\-(\d+)/);null!==t&&(i=t[1]);return i}(a,i),u=e(".wmu-add-"+m+" #wmu-"+i+"-"+m,t);e("img",a).attr("src",""),e(a).removeClass("wmu-show"),e(".wmu-add-"+m,t).addClass("wmu-show");var o,w,c=(o=s,w="",e.each(o,function(e,a){w+="."+a+","}),w);e(u).replaceWith('<input id="wmu-'+i+"-"+m+'" class="wmu-'+i+'" type="file" accept="'+c+'" name="wmu_'+i+'[]"/>')}),wpdiscuzAjaxObj.wmuAddLightBox=function(){1==wpdiscuzAjaxObj.wpdiscuz_options.wmuIsLightbox&&e(".wmu-attached-image-link").colorbox({maxHeight:"95%",rel:"wmu-attached-image-link"})},wpdiscuzAjaxObj.wmuHideAll=function(a,i){parseInt(a)>=0?(e(".wmu-tabs",i).removeClass("wmu-show"),e(".wmu-preview",i).removeClass("wmu-show"),e(".wmu-preview img",i).attr("src",""),e.each(e(".wmu-add",i),function(){e(this).hasClass("wmu-show")||e(this).addClass("wmu-show")}),e(".wmu_reset",this).val(""),e(".wmu-multiple",this).removeClass("wmu-active"),t()):console.log("error occured while posting comment")},wmuFrontJsObj.wmuLazyLoadImages&&(wpdiscuzAjaxObj.wmuImagesInit=function(){for(var a=e("img"),t=0;t<a.length;t++){var i=e(a[t]),s=i.attr("wmu-data-src");s&&i.attr("src",s)}}),wmuFrontJsObj.wmuLazyLoadImages){!function(){for(var a=e("img"),t=0;t<a.length;t++){var i=e(a[t]),s=i.attr("wmu-data-src");s&&i.attr("src",s)}}()}});